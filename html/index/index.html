<!DOCTYPE html>
<html>

<head data-gwd-animation-mode="quickMode">
  <title>Log on Spark</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="generator" content="Google Web Designer 1.3.0.0410">
  
  <style type="text/css">
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
    body {
      -webkit-transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      -webkit-transform-style: preserve-3d;
      background-image: none;
      background-color: rgb(255, 255, 255);
    }
    .imageled {
      position: relative;
      top: 67px;
      width: 144px;
      height: 144px;
    }
  </style>
</head>

<body>
  <div id="spark-login">
    <script src="http://cdn.jsdelivr.net/sparkjs/0.4.2/spark.min.js"></script>
    <script>
 
      var globalDevices = [];
      
      sparkLogin(function(data) {
        var devices = spark.listDevices();

        devices.then(

          function(devices) {
            globalDevices = devices;
            for (var i = 0; i < devices.length; i++) {
              console.log('Device[' + i + ']: ' + devices[i].name);
              //document.getElementById('CoreData').innerHTML += 'Error getting attributes on ' + devices[i].name + '<BR>';
              console.log('connected: ' + devices[i].connected);
              console.log('variables: ' + devices[i].variables);
              console.log('functions: ' + devices[i].functions);
              console.log('version: ' + devices[i].version);
              console.log('requiresUpgrade: ' + devices[i].requiresUpgrade);
            }
            callSpark(devices[0]);
          },

          function(err) {
            console.log('List devices call failed:', err);
          });
      });

      var state = [false, false, false, false, false, false, false];
      var params = {states: state,
                    blinkYN: false,
                    trailYN: false};


      function changeState(id){
        state[id] = !state[id];
        console.log(params);
        if (state[id])
          document.getElementById("Led"+id).src = "assets/led.png";
        else
          document.getElementById("Led"+id).src = "assets/ledoff.png";
        
        callSpark(globalDevices[0]);
      }

      function callSpark(device) {
        console.log('Calling Spark with: ');
        console.log(device);
        console.log(params);
        device.callFunction('doStuff', params).then(
          function(data){console.log('Call Spark OK', data);},
          function(err){console.log('Error calling Spark: ', err);}
        );
      }

    </script>  
  </div>

  <img src="assets/ledoff.png" class="imageled" id="Led0" onClick="changeState(0)">
  <img src="assets/ledoff.png" class="imageled" id="Led1" onClick="changeState(1)">
  <img src="assets/ledoff.png" class="imageled" id="Led2" onClick="changeState(2)">
  <img src="assets/ledoff.png" class="imageled" id="Led3" onClick="changeState(3)">
  <img src="assets/ledoff.png" class="imageled" id="Led4" onClick="changeState(4)">
  <img src="assets/ledoff.png" class="imageled" id="Led5" onClick="changeState(5)">
  <img src="assets/ledoff.png" class="imageled" id="Led6" onClick="changeState(6)">
</body>

</html>